{% extends "base_admin.html" %}

{% block html_title %}
<title>
  All enterprises
</title>
{% endblock html_title %}

{% block content %}
<h1 id="">All enterprises</h1>
<p>
  <a class="button" href="{{ url_for('admin.new_enterprise') }}">New</a>
</p>
<p>
  Drag the rows to sort the enterprises. Enterprises shown to visitors will have the same order you sort.
</p>
<table id="enterprises">
  <thead>
    <tr>
      <th class="index">Name</th>
      <th>Shortname</th>
      <th>&nbsp;</th>
      <th>&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    {% for e in enterprises %}
    <tr>
      <th class="index">{{ e.name }}</th>
      <th>{{ e.shortname }}</th>
      <th>
	<a href="{{ url_for('admin.edit_enterprise', keyurl=e.key.urlsafe()) }}">
	  edit
	</a>
      </th>
      <th>
	<a href="{{ url_for('admin.delete_enterprise', keyurl=e.key.urlsafe()) }}">
	  delete
	</a>
      </th>
    </tr>
    {% else %}
    <tr>
      <td colspan="5">no enterprise provided yet</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<script>
var fixHelperModified = function(e, tr) {
    var $originals = tr.children();
    var $helper = tr.clone();
    $helper.children().each(function(index) {
        $(this).width($originals.eq(index).width())
    });
    return $helper;
},
    updateIndex = function(e, ui) {
        $('td.index', ui.item.parent()).each(function (i) {
            $(this).html(i + 1);
        });
    };

$("#enterprises tbody").sortable({
    helper: fixHelperModified,
    stop: updateIndex
}).disableSelection();
</script>
{% endblock content %}
